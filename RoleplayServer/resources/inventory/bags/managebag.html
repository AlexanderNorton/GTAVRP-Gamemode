<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="../../stylesheet/css/metro.css" rel="stylesheet">
    <script src="../../jquery.js"></script>
    <script src="../../stylesheet/js/metro.js"></script>
    <link href="../../stylesheet/css/metro-icons.css" rel="stylesheet">
    
    <script>
        function fillItems(leftJson, rightJson) {
            var leftList = JSON.parse(leftJson);
            var rightList = JSON.parse(rightJson);
            //Loop in each.
            $.each(leftList,
                    function (i, val) {
                        $("#LeftItems").append(`<div class="list" itemid="${val[0]}">
                    <div class="list-content">
                        <span class="list-title">${val[1]}</span>
                        <span class="list-subtitle" shortname="${val[2]}">Short Name: ${val[2]}</span>
                        <span class="list-remark" amount="${val[3]}">Amount: ${val[3]}</span>
                    </div>
                </div>`);
                    });

            $.each(rightList,
                    function (i, val) {
                        $("#RightItems").append(`<div class="list" itemid="${val[0]}">
                    <div class="list-content">
                        <span class="list-title">${val[1]}</span>
                        <span class ="list-subtitle" shortname="${val[2]}">Short Name: ${val[2]}</span>
                        <span class ="list-remark" amount="${val[3]}">Amount: ${val[3]}</span>
                    </div>
                </div>`);
                    });
        }

        function moveItemFromLeftToRightSucess(id, itemname, amount) {
            //Get old item from inv.
            var item = $("#LeftItems").find(`.list[itemid='${id}']`);
            //If amount there is equal to what to be removed, we remove whole thing and then add to list.
            if (item.find('span.list-remark').attr("amount") == amount) {
                //Add and remove.
                $("#RightItems").append(item);
                $("#LeftItems").remove(`.list[itemid='${id}']`);
            } else {
                //Check if there is an item inside the target inv with that id.
                var titem = $("#RightItems").find(`.list[itemid='${id}']`);
                if (!!titem.length) { //If was found.
                    //Change amount of target.
                    var oldValue = parseInt(titem.find('span.list-remark').attr("amount"));
                    titem.find('span.list-remark').attr("amount", oldValue + parseInt(amount));
                } else {
                    //If not, add it.
                    $("#RightItems").append(item);
                }
                //Change amount of sender.
                var ov = parseInt(item.find('span.list-remark').attr("amount"));
                item.find('span.list-remark').attr("amount", ov - parseInt(amount));
            }
        }

        //Events.
        $(document).ready(function () {
            $("#ExitButton").click(function () {
                resourceCall("ExitWindow");
            });

            $("#MoveFromLeftToRight").click(function () {
                //Get clicked one: 
                var item = $("#LeftItems").find('div.active');
                //Send event.
                resourceCall("moveFromLeftToRight", item.attr("itemid"), item.find("span.list-subtitle").attr("shortname"));
            });
            
        });
    </script>
</head>
<body>

<div class="flex-grid" style="margin: 5px; background-color: white;">
    <div class="row cells3">
        <div class="cell">
            <h3 class="header">Inventory Items:</h3>
            <div class="listview-outlook" id="LeftItems" data-role="listview" style="width: 300px; height: 500px; overflow-y: auto; border: black solid 1px;">
                <!-- <div class="list">
                    <div class="list-content">
                        <span class="list-title">Miners Bag - (defaultname)</span>
                        <span class="list-subtitle">Short Name: bag_defaultname</span>
                        <span class="list-remark">Amount: 1</span>
                    </div>
                </div>  -->
            </div>
        </div>

        <div class="cell">
            <div style="text-align: center; margin-top: 200px;">
                <button class="button primary" id="MoveFromLeftToRight" style="width: 100px; margin: auto; margin-bottom: 5px;">></button><br/>
                <button class="button primary" id="MoveFromRightToLeft" style="width: 100px; margin: auto;"><</button>
            </div>
        </div>

        <div class="cell">
            <h3 class="header">Bag Items:</h3>
            <div class="listview-outlook" id="RightItems" data-role="listview" style="width: 300px; height: 500px; overflow-y: auto; border: black solid 1px;">
                <!-- Add items. -->
            </div>
            <button class="button success" id="ExitButton" style="width: 100px; float: right;">Exit</button>
        </div>
    </div>
</div>
</body>
</html>